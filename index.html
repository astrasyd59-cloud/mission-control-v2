<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="cache-control" content="no-cache, no-store, must-revalidate">
    <meta name="pragma" content="no-cache">
    <title>Mission Control | Dibs</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0c; --bg-secondary: #0f0f12; --bg-tertiary: #141418;
            --accent-gold: #fbbf24; --accent-amber: #f59e0b; --accent-bronze: #d97706;
            --text-primary: #fafaf9; --text-secondary: #e7e5e4; --text-muted: #a8a29e;
            --success: #22c55e; --warning: #f59e0b; --danger: #ef4444; --info: #3b82f6;
            --priority-critical: #ef4444; --priority-medium: #f59e0b; --priority-low: #22c55e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
        .header { position: sticky; top: 0; z-index: 100; background: linear-gradient(180deg, rgba(10,10,12,0.98) 0%, rgba(15,15,18,0.95) 100%); backdrop-filter: blur(24px); border-bottom: 1px solid rgba(251,191,36,0.1); padding: 1rem 1.5rem; }
        .header-content { max-width: 1600px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 1rem; flex-wrap: wrap; }
        .logo { display: flex; align-items: center; gap: 0.5rem; }
        .logo-icon { width: 42px; height: 42px; background: linear-gradient(135deg, var(--accent-gold), var(--accent-amber), var(--accent-bronze)); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
        .logo-text { font-size: 1.35rem; font-weight: 800; background: linear-gradient(135deg, var(--text-primary), var(--accent-gold)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .logo-subtext { font-size: 0.6875rem; color: var(--accent-amber); text-transform: uppercase; letter-spacing: 0.15em; }
        .nav-tabs { display: flex; gap: 4px; background: rgba(20,20,24,0.6); padding: 4px; border-radius: 16px; border: 1px solid rgba(251,191,36,0.08); overflow-x: auto; }
        .nav-tab { padding: 0.75rem 1rem; border-radius: 12px; cursor: pointer; font-size: 0.8125rem; font-weight: 500; color: var(--text-muted); border: none; background: transparent; white-space: nowrap; }
        .nav-tab.active { background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(245,158,11,0.1)); color: var(--accent-gold); border: 1px solid rgba(251,191,36,0.2); }
        .main-content { max-width: 1600px; margin: 0 auto; padding: 1.5rem; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .hero-section { position: relative; background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary)); border-radius: 24px; padding: 2rem; margin-bottom: 1.5rem; border: 1px solid rgba(251,191,36,0.1); }
        .hero-bg { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: url('https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=1920&q=80'); background-size: cover; opacity: 0.3; }
        .hero-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, rgba(10,10,12,0.7), rgba(15,15,18,0.9)); }
        .hero-content { position: relative; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1.5rem; }
        .hero-greeting { font-size: 2rem; font-weight: 700; }
        .hero-time { font-size: 3rem; font-weight: 200; color: var(--accent-gold); }
        
        .section { background: rgba(20,20,24,0.6); border: 1px solid rgba(251,191,36,0.1); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .section-title { display: flex; align-items: center; gap: 0.5rem; font-size: 1.125rem; font-weight: 600; }
        
        /* CALENDAR */
        .calendar-section { background: linear-gradient(135deg, rgba(251,191,36,0.05), rgba(20,20,24,0.8)); border: 1px solid rgba(251,191,36,0.15); border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .calendar-title { font-size: 1.125rem; font-weight: 600; color: var(--accent-gold); }
        .calendar-nav { display: flex; gap: 0.5rem; }
        .calendar-nav button { background: rgba(251,191,36,0.1); border: 1px solid rgba(251,191,36,0.2); color: var(--accent-gold); padding: 0.25rem 0.75rem; border-radius: 6px; cursor: pointer; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .calendar-day-header { font-size: 0.75rem; color: var(--text-muted); text-align: center; padding: 0.25rem; }
        .calendar-day { aspect-ratio: 1; background: rgba(20,20,24,0.6); border: 1px solid rgba(251,191,36,0.05); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; min-height: 60px; }
        .calendar-day:hover { background: rgba(251,191,36,0.1); border-color: rgba(251,191,36,0.3); }
        .calendar-day.today { background: linear-gradient(135deg, rgba(251,191,36,0.3), rgba(245,158,11,0.2)); border-color: var(--accent-gold); }
        .calendar-day-num { font-weight: 600; }
        .calendar-day-note { font-size: 0.625rem; color: var(--accent-gold); max-width: 90%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* WATCHLIST */
        .watchlist { background: rgba(20,20,24,0.6); border: 1px solid rgba(251,191,36,0.1); border-radius: 12px; overflow: hidden; }
        .watchlist-row { display: flex; align-items: center; gap: 1rem; padding: 0.75rem 1rem; border-bottom: 1px solid rgba(251,191,36,0.05); }
        .watchlist-row:last-child { border-bottom: none; }
        .watchlist-icon { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; background: rgba(251,191,36,0.1); border-radius: 6px; }
        .watchlist-name { flex: 1; font-weight: 500; }
        .watchlist-symbol { color: var(--text-muted); font-size: 0.8125rem; min-width: 50px; }
        .watchlist-price { font-weight: 600; min-width: 100px; text-align: right; }
        .watchlist-change { font-size: 0.8125rem; font-weight: 500; min-width: 60px; text-align: right; }
        .watchlist-change.up { color: var(--success); }
        .watchlist-change.down { color: var(--danger); }
        
        /* TASKS - NEW DESIGN */
        .task-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .task-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; background: rgba(251,191,36,0.03); border: 1px solid rgba(251,191,36,0.08); border-radius: 12px; transition: all 0.2s ease; }
        .task-item:hover { background: rgba(251,191,36,0.06); border-color: rgba(251,191,36,0.15); }
        .task-item.completed { opacity: 0.5; }
        .task-item.completed .task-text { text-decoration: line-through; color: var(--text-muted); }
        .task-checkbox { width: 22px; height: 22px; border: 2px solid rgba(251,191,36,0.3); border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.75rem; }
        .task-checkbox.checked { background: var(--accent-gold); border-color: var(--accent-gold); color: var(--bg-primary); }
        .task-content { flex: 1; min-width: 0; }
        .task-text { font-size: 0.9375rem; word-break: break-word; }
        .task-input { width: 100%; background: transparent; border: none; color: var(--text-primary); font-size: 0.9375rem; outline: none; }
        .task-input::placeholder { color: var(--text-muted); }
        .task-priority { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; cursor: pointer; }
        .task-priority.critical { background: rgba(239,68,68,0.2); color: var(--priority-critical); border: 1px solid rgba(239,68,68,0.3); }
        .task-priority.medium { background: rgba(245,158,11,0.2); color: var(--priority-medium); border: 1px solid rgba(245,158,11,0.3); }
        .task-priority.low { background: rgba(34,197,94,0.2); color: var(--priority-low); border: 1px solid rgba(34,197,94,0.3); }
        .task-delete { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.25rem; opacity: 0; transition: opacity 0.2s; }
        .task-item:hover .task-delete { opacity: 1; }
        .task-delete:hover { color: var(--danger); }
        
        .task-add-row { display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; background: rgba(251,191,36,0.05); border: 2px dashed rgba(251,191,36,0.2); border-radius: 12px; margin-top: 0.5rem; }
        .task-add-icon { color: var(--accent-gold); font-size: 1.25rem; }
        .task-add-input { flex: 1; background: transparent; border: none; color: var(--text-primary); font-size: 0.9375rem; outline: none; }
        .task-add-input::placeholder { color: var(--text-muted); }
        .task-add-priority { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.6875rem; font-weight: 600; cursor: pointer; background: rgba(251,191,36,0.1); color: var(--accent-gold); border: 1px solid rgba(251,191,36,0.2); }
        
        .show-more-btn { width: 100%; padding: 0.75rem; background: rgba(251,191,36,0.05); border: 1px solid rgba(251,191,36,0.1); border-radius: 8px; color: var(--accent-gold); cursor: pointer; font-size: 0.875rem; margin-top: 0.5rem; }
        .show-more-btn:hover { background: rgba(251,191,36,0.1); }
        
        /* NEWS */
        .news-item { display: flex; gap: 1rem; padding: 1rem; background: rgba(251,191,36,0.03); border-radius: 12px; margin-bottom: 0.75rem; cursor: pointer; transition: all 0.2s; }
        .news-item:hover { background: rgba(251,191,36,0.06); }
        .news-num { width: 28px; height: 28px; background: rgba(251,191,36,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: 600; flex-shrink: 0; }
        .news-content { flex: 1; }
        .news-title { font-weight: 500; margin-bottom: 0.25rem; }
        .news-preview { font-size: 0.8125rem; color: var(--text-muted); }
        .news-meta { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
        .news-source { font-size: 0.75rem; color: var(--accent-gold); }
        .news-cat { font-size: 0.75rem; color: var(--text-muted); background: rgba(251,191,36,0.1); padding: 0.125rem 0.5rem; border-radius: 4px; }
        
        /* QUOTE */
        .quote-box { background: linear-gradient(135deg, rgba(251,191,36,0.05), rgba(245,158,11,0.03)); border-left: 3px solid var(--accent-gold); padding: 1.25rem; border-radius: 0 12px 12px 0; margin-top: 1rem; font-style: italic; }
        .quote-author { margin-top: 0.75rem; font-size: 0.875rem; color: var(--accent-amber); font-style: normal; }
        
        /* BUTTONS */
        .btn { background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(245,158,11,0.1)); border: 1px solid rgba(251,191,36,0.2); color: var(--accent-gold); padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.875rem; }
        .btn:hover { background: rgba(251,191,36,0.2); }
        
        @media (max-width: 768px) {
            .hero-greeting { font-size: 1.5rem; }
            .hero-time { font-size: 2rem; }
            .nav-tabs { flex-wrap: nowrap; overflow-x: auto; }
            .section-header { flex-wrap: wrap; gap: 0.5rem; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üó°Ô∏è</div>
                <div>
                    <div class="logo-text">Mission Control</div>
                    <div class="logo-subtext">OpenClaw Empire</div>
                </div>
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('dashboard')">üìä Dashboard</button>
                <button class="nav-tab" onclick="switchTab('projects')">üìã Projects</button>
                <button class="nav-tab" onclick="switchTab('revenue')">üí∞ Revenue</button>
                <button class="nav-tab" onclick="switchTab('ai-costs')">ü§ñ AI Costs</button>
                <button class="nav-tab" onclick="switchTab('notes')">üìù Notes</button>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <!-- DASHBOARD TAB -->
        <div class="tab-content active" id="dashboard">
            <div class="hero-section">
                <div class="hero-bg"></div>
                <div class="hero-overlay"></div>
                <div class="hero-content">
                    <div>
                        <h1 class="hero-greeting" id="greeting">Loading...</h1>
                        <p id="subtitle">Loading...</p>
                    </div>
                    <div class="hero-time" id="clock">--:--</div>
                </div>
            </div>

            <!-- CALENDAR -->
            <div class="calendar-section">
                <div class="calendar-header">
                    <span class="calendar-title" id="calendarMonth">Loading...</span>
                    <div class="calendar-nav">
                        <button onclick="changeMonth(-1)">‚Üê</button>
                        <button onclick="resetToToday()">Today</button>
                        <button onclick="changeMonth(1)">‚Üí</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar generated by JS -->
                </div>
            </div>

            <!-- WATCHLIST -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üìà Watchlist</h2>
                    <button class="btn" onclick="fetchCryptoPrices()">‚Üª Refresh</button>
                </div>
                <div class="watchlist" id="watchlist">
                    <div class="watchlist-row">
                        <span class="watchlist-icon">‚Çø</span>
                        <span class="watchlist-name">Bitcoin</span>
                        <span class="watchlist-symbol">BTC</span>
                        <span class="watchlist-price" id="btc-price">--</span>
                        <span class="watchlist-change" id="btc-change">--</span>
                    </div>
                    <div class="watchlist-row">
                        <span class="watchlist-icon">Œû</span>
                        <span class="watchlist-name">Ethereum</span>
                        <span class="watchlist-symbol">ETH</span>
                        <span class="watchlist-price" id="eth-price">--</span>
                        <span class="watchlist-change" id="eth-change">--</span>
                    </div>
                    <div class="watchlist-row">
                        <span class="watchlist-icon">‚óé</span>
                        <span class="watchlist-name">Solana</span>
                        <span class="watchlist-symbol">SOL</span>
                        <span class="watchlist-price" id="sol-price">--</span>
                        <span class="watchlist-change" id="sol-change">--</span>
                    </div>
                    <div class="watchlist-row">
                        <span class="watchlist-icon">‚Ç≥</span>
                        <span class="watchlist-name">Cardano</span>
                        <span class="watchlist-symbol">ADA</span>
                        <span class="watchlist-price" id="ada-price">--</span>
                        <span class="watchlist-change" id="ada-change">--</span>
                    </div>
                    <div class="watchlist-row">
                        <span class="watchlist-icon">‚óà</span>
                        <span class="watchlist-name">Avalanche</span>
                        <span class="watchlist-symbol">AVAX</span>
                        <span class="watchlist-price" id="avax-price">--</span>
                        <span class="watchlist-change" id="avax-change">--</span>
                    </div>
                </div>
            </div>

            <!-- TASKS -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">‚úì Tasks</h2>
                    <button class="btn" onclick="clearCompleted()">Clear Done</button>
                </div>
                <div class="task-list" id="taskList">
                    <!-- Tasks rendered by JS -->
                </div>
                <button class="show-more-btn" id="showMoreBtn" onclick="toggleShowMore()" style="display:none;">Show More Tasks</button>
                <div class="task-add-row">
                    <span class="task-add-icon">+</span>
                    <input type="text" class="task-add-input" id="newTaskInput" placeholder="Add a new task..." onkeypress="if(event.key==='Enter')addTask()">
                    <span class="task-add-priority" id="newTaskPriority" onclick="cyclePriority()">MEDIUM</span>
                </div>
            </div>

            <!-- NEWS -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üì∞ Briefing</h2>
                    <button class="btn" onclick="loadBriefing()">‚Üª Refresh</button>
                </div>
                <div id="newsList">
                    <!-- News rendered by JS -->
                </div>
                <div class="quote-box" id="quoteBox">
                    Loading quote...
                </div>
            </div>
        </div>

        <!-- AI COSTS TAB -->
        <div class="tab-content" id="ai-costs">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ü§ñ AI Costs</h2>
                </div>
                <p>AI infrastructure costs tracking coming soon...</p>
            </div>
        </div>

        <!-- NOTES TAB -->
        <div class="tab-content" id="notes">
            <div class="section">
                <h2 class="section-title">üìù Notes</h2>
                <textarea style="width:100%;height:400px;background:rgba(251,191,36,0.03);border:1px solid rgba(251,191,36,0.1);border-radius:12px;padding:1rem;color:var(--text-primary);font-family:inherit;resize:vertical;" placeholder="Start writing..."></textarea>
            </div>
        </div>
    </main>

    <!-- DATE MODAL -->
    <div id="dateModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:200;align-items:center;justify-content:center;" onclick="if(event.target===this)closeDateModal()">
        <div style="background:linear-gradient(135deg,var(--bg-secondary),var(--bg-tertiary));border:1px solid rgba(251,191,36,0.2);border-radius:16px;width:90%;max-width:400px;max-height:80vh;overflow:hidden;">
            <div style="padding:1rem 1.5rem;border-bottom:1px solid rgba(251,191,36,0.1);display:flex;justify-content:space-between;align-items:center;">
                <span id="dateModalTitle" style="font-size:1.125rem;font-weight:600;color:var(--accent-gold);">Date</span>
                <button onclick="closeDateModal()" style="background:none;border:none;color:var(--text-muted);font-size:1.5rem;cursor:pointer;">√ó</button>
            </div>
            <div style="padding:1rem;">
                <div id="dateNotesList" style="max-height:200px;overflow-y:auto;margin-bottom:1rem;"></div>
                <textarea id="dateNoteInput" style="width:100%;background:rgba(251,191,36,0.05);border:1px solid rgba(251,191,36,0.2);border-radius:8px;padding:0.5rem;color:var(--text-primary);min-height:60px;resize:vertical;" placeholder="Add a note..."></textarea>
                <button onclick="addDateNote()" style="width:100%;padding:0.75rem;background:linear-gradient(135deg,rgba(251,191,36,0.15),rgba(245,158,11,0.1));border:1px solid rgba(251,191,36,0.2);border-radius:8px;color:var(--accent-gold);cursor:pointer;margin-top:0.5rem;">+ Add Note</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // DATA & STATE
        // ==========================================
        const DEFAULT_TASKS = [
            { id: 1, text: 'Sort out SQL database setup', completed: false, priority: 'high' },
            { id: 2, text: 'Sync Google Calendar with Mission Control', completed: false, priority: 'high' },
            { id: 3, text: 'Set up Gmail email reading automation', completed: false, priority: 'high' },
            { id: 4, text: 'Scrape Twitter/X for trading news', completed: false, priority: 'medium' },
            { id: 5, text: 'Integrate Google API for news feed', completed: false, priority: 'medium' }
        ];

        let tasks = JSON.parse(localStorage.getItem('mc_tasks_v7')) || DEFAULT_TASKS;
        let showAllTasks = false;
        let newTaskPriority = 'medium';
        let currentCalendarDate = new Date();
        let selectedDate = null;
        let dateNotes = JSON.parse(localStorage.getItem('mc_dateNotes')) || {};

        // ==========================================
        // INITIALIZATION - Multiple strategies
        // ==========================================
        function init() {
            console.log('[MC] Initializing...');
            updateClock();
            renderCalendar();
            renderTasks();
            loadBriefing();
            fetchCryptoPrices();
            setInterval(updateClock, 1000);
            setInterval(fetchCryptoPrices, 300000);
            console.log('[MC] Initialized successfully');
        }

        // Run immediately if DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Backup: run after window load
        window.addEventListener('load', () => {
            if (!window.mcInitDone) {
                console.log('[MC] Backup init triggered');
                init();
                window.mcInitDone = true;
            }
        });

        // ==========================================
        // CLOCK
        // ==========================================
        function updateClock() {
            const now = new Date();
            const timeEl = document.getElementById('clock');
            const greetingEl = document.getElementById('greeting');
            const subtitleEl = document.getElementById('subtitle');
            
            if (timeEl) timeEl.textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
            
            const hour = now.getHours();
            let greeting = 'Good evening';
            let subtitle = 'Time to rest and recharge';
            
            if (hour >= 5 && hour < 12) {
                greeting = 'Good morning';
                subtitle = 'The early bird catches the alpha';
            } else if (hour >= 12 && hour < 17) {
                greeting = 'Good afternoon';
                subtitle = 'Mid-day momentum check';
            }
            
            if (greetingEl) greetingEl.textContent = greeting + ', Dibs!';
            if (subtitleEl) subtitleEl.textContent = subtitle;
        }

        // ==========================================
        // CALENDAR
        // ==========================================
        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
            
            const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            const monthEl = document.getElementById('calendarMonth');
            const gridEl = document.getElementById('calendarGrid');
            
            if (monthEl) monthEl.textContent = monthNames[month] + ' ' + year;
            if (!gridEl) return;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
            
            let html = dayNames.map(d => `<div class="calendar-day-header">${d}</div>`).join('');
            
            for (let i = 0; i < firstDay; i++) html += '<div></div>';
            
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = isCurrentMonth && day === today.getDate();
                const dateKey = `${year}-${month}-${day}`;
                const notes = dateNotes[dateKey] || [];
                const hasNote = notes.length > 0;
                
                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''}" onclick="openDateModal(${day})">
                        <span class="calendar-day-num">${day}</span>
                        ${hasNote ? `<span class="calendar-day-note">${notes[0].text.substring(0, 10)}${notes[0].text.length > 10 ? '...' : ''}</span>` : ''}
                    </div>
                `;
            }
            
            gridEl.innerHTML = html;
        }

        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendar();
        }

        function resetToToday() {
            currentCalendarDate = new Date();
            renderCalendar();
        }

        function openDateModal(day) {
            selectedDate = day;
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const dateKey = `${year}-${month}-${day}`;
            const notes = dateNotes[dateKey] || [];
            
            const titleEl = document.getElementById('dateModalTitle');
            const listEl = document.getElementById('dateNotesList');
            
            if (titleEl) {
                const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
                titleEl.textContent = `${monthNames[month]} ${day}, ${year}`;
            }
            
            if (listEl) {
                if (notes.length === 0) {
                    listEl.innerHTML = '<div style="color:var(--text-muted);text-align:center;padding:1rem;">No notes for this date</div>';
                } else {
                    listEl.innerHTML = notes.map((note, idx) => `
                        <div style="display:flex;align-items:flex-start;gap:0.5rem;padding:0.5rem;background:rgba(251,191,36,0.05);border-radius:8px;margin-bottom:0.5rem;">
                            <span style="flex:1;font-size:0.875rem;">${note.text}</span>
                            <button onclick="deleteDateNote(${idx})" style="background:none;border:none;color:var(--text-muted);cursor:pointer;">√ó</button>
                        </div>
                    `).join('');
                }
            }
            
            const modal = document.getElementById('dateModal');
            if (modal) modal.style.display = 'flex';
        }

        function closeDateModal() {
            const modal = document.getElementById('dateModal');
            if (modal) modal.style.display = 'none';
            selectedDate = null;
        }

        function addDateNote() {
            if (!selectedDate) return;
            const input = document.getElementById('dateNoteInput');
            const text = input ? input.value.trim() : '';
            if (!text) return;
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const dateKey = `${year}-${month}-${selectedDate}`;
            
            if (!dateNotes[dateKey]) dateNotes[dateKey] = [];
            dateNotes[dateKey].push({ text, created: new Date().toISOString() });
            
            localStorage.setItem('mc_dateNotes', JSON.stringify(dateNotes));
            if (input) input.value = '';
            openDateModal(selectedDate);
            renderCalendar();
        }

        function deleteDateNote(idx) {
            if (!selectedDate) return;
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const dateKey = `${year}-${month}-${selectedDate}`;
            
            if (dateNotes[dateKey]) {
                dateNotes[dateKey].splice(idx, 1);
                if (dateNotes[dateKey].length === 0) delete dateNotes[dateKey];
                localStorage.setItem('mc_dateNotes', JSON.stringify(dateNotes));
                openDateModal(selectedDate);
                renderCalendar();
            }
        }

        // ==========================================
        // CRYPTO
        // ==========================================
        async function fetchCryptoPrices() {
            const ids = 'bitcoin,ethereum,solana,cardano,avalanche-2';
            const symbols = { bitcoin: 'btc', ethereum: 'eth', solana: 'sol', cardano: 'ada', 'avalanche-2': 'avax' };
            
            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`);
                if (!response.ok) throw new Error('API error');
                const data = await response.json();
                
                for (const [coin, info] of Object.entries(data)) {
                    const sym = symbols[coin];
                    const priceEl = document.getElementById(`${sym}-price`);
                    const changeEl = document.getElementById(`${sym}-change`);
                    
                    if (priceEl) priceEl.textContent = '$' + info.usd.toLocaleString();
                    if (changeEl) {
                        const change = info.usd_24h_change;
                        changeEl.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
                        changeEl.className = 'watchlist-change ' + (change >= 0 ? 'up' : 'down');
                    }
                }
            } catch (e) {
                console.log('[MC] Crypto fetch failed, using fallback');
                const fallback = { btc: [67704, 0.67], eth: [2958, 0.46], sol: [84.38, 1.78], ada: [0.28, 3.24], avax: [9.15, 2.42] };
                for (const [sym, [price, change]] of Object.entries(fallback)) {
                    const priceEl = document.getElementById(`${sym}-price`);
                    const changeEl = document.getElementById(`${sym}-change`);
                    if (priceEl) priceEl.textContent = '$' + price.toLocaleString();
                    if (changeEl) {
                        changeEl.textContent = (change >= 0 ? '+' : '') + change + '%';
                        changeEl.className = 'watchlist-change ' + (change >= 0 ? 'up' : 'down');
                    }
                }
            }
        }

        // ==========================================
        // TASKS - NEW DESIGN
        // ==========================================
        function renderTasks() {
            const listEl = document.getElementById('taskList');
            const showMoreBtn = document.getElementById('showMoreBtn');
            if (!listEl) return;
            
            // Sort: incomplete first, then by priority
            const sorted = [...tasks].sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                const prioOrder = { high: 0, medium: 1, low: 2 };
                return prioOrder[a.priority] - prioOrder[b.priority];
            });
            
            const displayTasks = showAllTasks ? sorted : sorted.slice(0, 5);
            
            listEl.innerHTML = displayTasks.map((task, idx) => `
                <div class="task-item ${task.completed ? 'completed' : ''}" data-id="${task.id}">
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="toggleTask(${task.id})">${task.completed ? '‚úì' : ''}</div>
                    <div class="task-content">
                        <input type="text" class="task-input ${task.completed ? 'completed' : ''}" value="${task.text}" 
                            onchange="updateTaskText(${task.id}, this.value)" 
                            onblur="saveTasks()">
                    </div>
                    <span class="task-priority ${task.priority}" onclick="cycleTaskPriority(${task.id})">${task.priority}</span>
                    <button class="task-delete" onclick="deleteTask(${task.id})">√ó</button>
                </div>
            `).join('');
            
            if (showMoreBtn) {
                showMoreBtn.style.display = sorted.length > 5 ? 'block' : 'none';
                showMoreBtn.textContent = showAllTasks ? 'Show Less' : `Show More (${sorted.length - 5})`;
            }
        }

        function toggleShowMore() {
            showAllTasks = !showAllTasks;
            renderTasks();
        }

        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                saveTasks();
                renderTasks();
            }
        }

        function updateTaskText(id, text) {
            const task = tasks.find(t => t.id === id);
            if (task) task.text = text;
        }

        function cycleTaskPriority(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                const order = ['high', 'medium', 'low'];
                const currentIdx = order.indexOf(task.priority);
                task.priority = order[(currentIdx + 1) % order.length];
                saveTasks();
                renderTasks();
            }
        }

        function cyclePriority() {
            const order = ['HIGH', 'MEDIUM', 'LOW'];
            const values = ['high', 'medium', 'low'];
            const currentIdx = order.indexOf(newTaskPriority.toUpperCase());
            const nextIdx = (currentIdx + 1) % order.length;
            newTaskPriority = values[nextIdx];
            const btn = document.getElementById('newTaskPriority');
            if (btn) {
                btn.textContent = order[nextIdx];
                btn.className = 'task-add-priority ' + newTaskPriority;
            }
        }

        function addTask() {
            const input = document.getElementById('newTaskInput');
            const text = input ? input.value.trim() : '';
            if (!text) return;
            
            tasks.push({
                id: Date.now(),
                text: text,
                completed: false,
                priority: newTaskPriority
            });
            
            if (input) input.value = '';
            saveTasks();
            renderTasks();
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            saveTasks();
            renderTasks();
        }

        function clearCompleted() {
            tasks = tasks.filter(t => !t.completed);
            saveTasks();
            renderTasks();
        }

        function saveTasks() {
            localStorage.setItem('mc_tasks_v7', JSON.stringify(tasks));
            // TODO: Sync with backend/Astra
        }

        // ==========================================
        // BRIEFING & NEWS
        // ==========================================
        const quotes = [
            { text: "The only way to achieve the impossible is to believe it is possible.", author: "Charles Kingsley" },
            { text: "A person grows up when he's able to overcome hardships.", author: "Jiraiya" },
            { text: "The world isn't perfect. But it's there for us, trying the best it can.", author: "Roy Mustang" },
            { text: "If you don't like your destiny, don't accept it.", author: "Naruto Uzumaki" },
            { text: "Hard work is worthless for those that don't believe in themselves.", author: "Naruto Uzumaki" }
        ];

        const newsData = {
            morning: [
                { id: 1, title: "Bitcoin breaks $42K resistance", source: "CoinDesk", category: "Trading", summary: "BTC shows strong momentum after weeks of consolidation." },
                { id: 2, title: "OpenClaw releases agent framework", source: "TechCrunch", category: "AI", summary: "Major update enables 100 parallel agents for complex tasks." },
                { id: 3, title: "Crypto market cap hits $1.6T", source: "Reuters", category: "Market", summary: "Overall market showing bullish sentiment as traditional finance eyes crypto." },
                { id: 4, title: "Remote work trends 2026", source: "Forbes", category: "Business", summary: "Trading from anywhere becoming standard. Tax implications explored." },
                { id: 5, title: "10 habits of successful traders", source: "Bloomberg", category: "Development", summary: "Discipline, journaling, and risk management top the list." }
            ],
            afternoon: [
                { id: 1, title: "ETH staking rewards increase", source: "CoinTelegraph", category: "Trading", summary: "Annual yield now at 4.2% as validator participation grows." },
                { id: 2, title: "AI coding assistants comparison", source: "The Verge", category: "AI", summary: "Kimi leads in complex reasoning tasks while maintaining cost efficiency." },
                { id: 3, title: "Side hustle income tax guide", source: "WSJ", category: "Business", summary: "2026 tax updates for freelancers and independent traders." },
                { id: 4, title: "Solana ecosystem growth", source: "Decrypt", category: "Market", summary: "DeFi TVL up 15% this month. NFT marketplace activity resurging." },
                { id: 5, title: "Time management for traders", source: "Inc", category: "Development", summary: "Focus blocks vs Pomodoro: Which works better for deep analysis?" }
            ],
            evening: [
                { id: 1, title: "Daily crypto market wrap", source: "CoinDesk", category: "Trading", summary: "BTC +2.3%, ETH +1.8%, SOL +5.2%. Volume above average." },
                { id: 2, title: "OpenAI announces new model", source: "TechCrunch", category: "AI", summary: "Multimodal capabilities expanded. Competition heating up." },
                { id: 3, title: "Freelance economy report 2026", source: "Forbes", category: "Business", summary: "Independent work up 23% YoY. Trading as primary income growing." },
                { id: 4, title: "Global markets close mixed", source: "Reuters", category: "Market", summary: "Asia markets up 1-2%. Crypto showing relative strength." },
                { id: 5, title: "Sleep and performance link", source: "Harvard Health", category: "Development", summary: "Quality rest improves decisions by 40%. Recovery is part of strategy." }
            ]
        };

        function loadBriefing() {
            const hour = new Date().getHours();
            let timeOfDay = 'evening';
            if (hour >= 5 && hour < 12) timeOfDay = 'morning';
            else if (hour >= 12 && hour < 17) timeOfDay = 'afternoon';
            
            const news = newsData[timeOfDay];
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            
            const newsEl = document.getElementById('newsList');
            const quoteEl = document.getElementById('quoteBox');
            
            if (newsEl) {
                newsEl.innerHTML = news.map(item => `
                    <div class="news-item" onclick="window.open('https://${item.source.toLowerCase().replace(/\s/g, '')}.com', '_blank')">
                        <div class="news-num">${item.id}</div>
                        <div class="news-content">
                            <div class="news-title">${item.title}</div>
                            <div class="news-preview">${item.summary}</div>
                            <div class="news-meta">
                                <span class="news-source">${item.source}</span>
                                <span class="news-cat">${item.category}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            if (quoteEl) {
                quoteEl.innerHTML = `${quote.text}<div class="quote-author">‚Äî ${quote.author}</div>`;
            }
        }

        // ==========================================
        // UTILS
        // ==========================================
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>